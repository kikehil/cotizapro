<div class="space-y-6">
    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                    <i class="fas fa-file-invoice text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm text-gray-500 font-medium">Cotizaciones Totales</p>
                    <p id="total-quotes" class="text-2xl font-bold text-gray-800">0</p>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-green-100 text-green-600">
                    <i class="fas fa-check-circle text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm text-gray-500 font-medium">Aceptadas</p>
                    <p id="accepted-quotes" class="text-2xl font-bold text-gray-800">0</p>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                    <i class="fas fa-clock text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm text-gray-500 font-medium">Pendientes</p>
                    <p id="pending-quotes" class="text-2xl font-bold text-gray-800">0</p>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                    <i class="fas fa-dollar-sign text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm text-gray-500 font-medium">Total Facturado</p>
                    <p id="total-revenue" class="text-2xl font-bold text-gray-800">$0.00</p>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Recent Quotes -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-bold text-gray-800">Ãšltimas Cotizaciones</h3>
                <a href="/cotizaciones" class="text-sm text-blue-600 hover:underline">Ver todas</a>
            </div>
            <div class="p-0 overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Folio</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                        </tr>
                    </thead>
                    <tbody id="latest-quotes-list" class="divide-y divide-gray-200">
                        <!-- Items will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pending Invoices -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-bold text-gray-800">Facturas Pendientes de Cobro</h3>
            </div>
            <div class="p-6">
                <div id="pending-invoices-list" class="space-y-4">
                    <!-- Items will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        ui.setTitle('Dashboard');
        loadData();
    });

    async function loadData() {
        try {
            const [resSummary, resPendingInvoices] = await Promise.all([
                axios.get('/api/dashboard/resumen'),
                axios.get('/api/dashboard/facturas-pendientes')
            ]);

            const { summary, latestQuotes } = resSummary.data;
            
            document.getElementById('total-quotes').innerText = summary.totalQuotes;
            document.getElementById('accepted-quotes').innerText = summary.acceptedQuotes;
            document.getElementById('pending-quotes').innerText = summary.pendingQuotes;
            document.getElementById('total-revenue').innerText = ui.formatCurrency(summary.totalRevenue);

            const latestList = document.getElementById('latest-quotes-list');
            latestList.innerHTML = latestQuotes.map(q => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">
                        <a href="/cotizaciones/${q.id}">${q.folio}</a>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${q.cliente.nombre}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-semibold">${ui.formatCurrency(q.total)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-${getStatusColor(q.estado)}-100 text-${getStatusColor(q.estado)}-800">
                            ${q.estado}
                        </span>
                    </td>
                </tr>
            `).join('');

            const pendingList = document.getElementById('pending-invoices-list');
            if (resPendingInvoices.data.length === 0) {
                pendingList.innerHTML = '<p class="text-sm text-gray-400 italic text-center py-4">No hay facturas pendientes</p>';
            } else {
                pendingList.innerHTML = resPendingInvoices.data.map(inv => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center font-bold text-xs">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-bold text-gray-800">${inv.numero_factura}</p>
                                <p class="text-xs text-gray-500">${inv.quote.cliente.nombre}</p>
                                <p class="text-[10px] text-blue-600 font-medium">Folio: ${inv.quote.folio}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-black text-gray-800">${ui.formatCurrency(inv.quote.total)}</p>
                            <a href="/cotizaciones/${inv.quote.id}" class="text-[10px] text-blue-500 hover:underline">Ver detalle</a>
                        </div>
                    </div>
                `).join('');
            }

        } catch (error) {
            console.error('Error loading dashboard:', error);
        }
    }

    function getStatusColor(status) {
        switch(status) {
            case 'Pendiente': return 'yellow';
            case 'Enviada': return 'blue';
            case 'Aceptada': return 'green';
            case 'Rechazada': return 'red';
            case 'Vencida': return 'gray';
            default: return 'gray';
        }
    }
</script>

